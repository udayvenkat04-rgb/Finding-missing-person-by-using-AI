<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missing Person Finder - Bring Loved Ones Home</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Ensure theme loads immediately */
        :root { color-scheme: light dark; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-search"></i>
            <span>Missing Person Finder</span>
        </div>
        <div class="nav-links">
            <a href="/" class="active">Home</a>
            <a href="#" id="dashboard-link" style="display: none;">Dashboard</a>
            <a href="#" id="admin-link" style="display: none;">Admin</a>
            <button class="theme-toggle" onclick="toggleAppleTheme()" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="btn btn-login" onclick="window.location.href='/login.html'">Login</button>
            <button class="btn btn-register" onclick="window.location.href='/register.html'">Register</button>
            <button class="btn btn-logout" style="display: none;" onclick="logout()">Logout</button>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Help Bring Them Home</h1>
        <p>Report missing persons and help reunite families using AI-powered facial recognition</p>
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Search by name or location...">
            <button onclick="searchMissing()"><i class="fas fa-search"></i> Search</button>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats">
        <div class="stat-item">
            <i class="fas fa-users"></i>
            <h3 id="total-cases">0</h3>
            <p>Total Cases</p>
        </div>
        <div class="stat-item">
            <i class="fas fa-check-circle"></i>
            <h3 id="resolved-cases">0</h3>
            <p>Resolved Cases</p>
        </div>
        <div class="stat-item">
            <i class="fas fa-clock"></i>
            <h3 id="active-cases">0</h3>
            <p>Active Cases</p>
        </div>
        <div class="stat-item">
            <i class="fas fa-smile"></i>
            <h3 id="reunited">0</h3>
            <p>Reunited Families</p>
        </div>
    </section>

    <!-- Recent Cases -->
    <section class="recent-cases">
        <h2>Recent Missing Persons Reports</h2>
        <div class="cases-grid" id="cases-grid">
            <!-- Cases will be loaded here -->
        </div>
    </section>

    <!-- Connection Status -->
    <div class="connection-status checking" id="connection-status">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Checking connection...</span>
    </div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Initialize theme and connection status
        document.addEventListener('DOMContentLoaded', function() {
            // Update connection status
            updateConnectionStatus();
            
            // Load stats and cases
            if (typeof loadStats === 'function') loadStats();
            if (typeof loadRecentCases === 'function') loadRecentCases();
        });

        // Update connection status
        async function updateConnectionStatus() {
            const statusDiv = document.getElementById('connection-status');
            try {
                const response = await fetch('http://localhost:5000/api/test');
                if (response.ok) {
                    statusDiv.className = 'connection-status connected';
                    statusDiv.innerHTML = '<i class="fas fa-check-circle"></i><span>Connected to server</span>';
                } else {
                    statusDiv.className = 'connection-status disconnected';
                    statusDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>Server error</span>';
                }
            } catch (error) {
                statusDiv.className = 'connection-status disconnected';
                statusDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>Cannot connect to server</span>';
            }
        }

        // Search function
        window.searchMissing = function() {
            const searchTerm = document.getElementById('search-input').value;
            if (searchTerm.trim()) {
                window.location.href = `/search.html?q=${encodeURIComponent(searchTerm)}`;
            }
        };

        // Handle enter key in search
        document.getElementById('search-input')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchMissing();
            }
        });
    </script>
</body>
</html>